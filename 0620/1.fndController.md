# FND Driver 만들기

![]({07F76517-9FC0-43FC-924E-D900859E7B32}.png)

***Timer가 `1ms`마다 인터럽트를 발생시켜 해당 인터럽트마다 FND를 갱신하는 구조로 작성하자***


    1. Timer Interrupt를 이용하여 1ms 간격으로 동작시키자
    2. ISR에서 FND를 갱신하는 코드를 작성하자


Interrupt 처리를 위해 NVIC를 사용해야한다.

이를 위해 다음 헤더파일을 가져오자

![alt text]({E6368B06-1494-49A1-8AB0-9F80D656B9CC}.png)


## 목표
### FND Driver의 Main Data
```c
#include "FND.h"

uint16_t fndDispNum =0; //fnd에 출력되는 display data

```

 * data 중심적으로 생각하자.
 * `fndDispNum` data를 FND에 출력하는 것만 고민하자

### function  

fndDisp를 write, read, display 했으면 좋겠다!

```c
void FND_WriteData(){
	fndDispNum = data;
}

uint16_t FND_ReadData(){
	return fndDispNum;
}

void FND_DispData(){
	//인터럽트가 발생하면 한 자리씩 출력한다.
}
```

## TIM 추가
interrupt를 발생시키기 위해 TIM을 추가하자

<img src="image.png" alt="TIM 구조도" width="250" />

**TIM2 사용**  
<img src="{17114079-7BAA-4CA0-9AFD-C2738AED39B4}.png" alt="TIM 레지스터 설정 예시" width="300" />

### TIM Register
![]({CC9A1CD6-A43C-4F8B-B229-9991BCEA6013}.png)

- **prescaler가 16**:   
	sysclock이 16MHz 일때, clock이 16이 들어오면 tick 1개가 나간다.  

- **counter Reigster** :   
	tick을 세는 애  

- **ARR Register** :  
	Auto Reload Register로, ARR 값과 CNT 값이 같아지면 CNT가 0으로 변경된다.
-> update Interrupt가 발생


**구조**  

![](image-1.png)

sysClock(16MHz)가 PSC(Prescaler)로 들어온다.  

<img src="{D7D50857-E910-4E10-A810-961F61AD5485}.png" alt="설명 이미지" width="300" />

CNT가 증가하다가 ARR과 같아지면 UI(Update Interrupt)가 발생한다.

> 1ms마다 인터럽트를 발생시키려면?
>> PSC를 16으로 설정하면 1MHz,   
	ARR을 1000으로 설정하면 1000Hz가 된다.
	(1kHz 단위의 인터럽트 발생)

	- CNT 증가 속도: 1Mhz 마다 CNT가 1씩 증가한다.
	- CNT가 1000에 도달하면 UI 발생

***"1MHz / 1000 = 1ms" 마다 인터럽트가 발생한다.***


